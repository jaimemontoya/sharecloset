<html>
  <head>
    <title>Sharitable</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Kite%20One">    
  </head>
  <body>
    <div id="base">
      <div id="login">
        <div class="main">
          <span id="logintext"><a href="#" id="loginbutton">Login</a></span>
      <span id="signuptext"><a href="#" id="signupbutton">Sign Up</a></span>
        </div>
      </div>
      <header>
        <div class="main">
          <div id="headerlogo">
            <span id="logo">Sharitable</span>
          </div>
          <ul id="headermenu">
            <li><a href="#" class="homebutton">Home</a></li>
            <li><a href="#" class="aboutbutton">About</a></li>
            <li><a href="#" class="contactbutton">Contact</a></li>
          </ul>
        </div>
      </header>
      <div id="contentarea">
        <div class="main">
          <div id="content">Main content</div>
        </div>
      </div>
    </div>
    <footer>
      <div class="main">
        <ul id="footermenu">
          <li><a href="#" class="homebutton">Home</a></li>
          <li><a href="#" class="aboutbutton">About</a></li>
          <li><a href="#" class="contactbutton">Contact</a></li>
        </ul>
      </div>
    </footer>
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function(){
      $("#signupbutton").click(function(){
           $.ajax({
            success: function(){
              $("#content").html("\
                <div>Username: <input id='user_name' type='text' size='30' /></div>\
    <div>Password: <input id='user_password' type='password' size='30' /></div>\
    <div>Zipcode: <input id='user_zip' type='number' size='30' /></div>\
    <div><button id='signup'>Sign Up</button></div>\
    ");
    }
    })
        });  
      
  $("#loginbutton").click(function(){
          $.ajax({
            success: function(){
              $("#content").html("\
                <div>\
                  <div>Username: <input id='usernameBox' type='text' size='20' /></div>\
                  <div>Password: <input id='passwordBox' type='password' size='20' /></div>\
                  <div><button id='loginButtonOnForm'>Login</button></div>\
                </div>\
                ");
              //   <div id='leftCol' style='float: left; width: 30%; background-color:white; height: 400px;'>\
              //     <h1>my items</h1>\
              //     <p> this is a test</p>\
              //     <button id='update' onclick='popup(mylink, windowname)'>UPDATE</button>\
              //   </div>\
              //   <div id='rightCol' style='float: right; width: 70%; background-color:gray; height:400px'>\
              //   <h1>my matches</h1>\
              //   <p> this is div 2</p>\
              //   <div id = 'item1' style='float:left; width =30%; background-color:blue; height: 200px;'>\
              //     <img src='elephant.jpe' width = '50px'>\
              //     <h4>Organization Name</h4>\
              //     <p>Here is information about this wonderful organization</p>\
              //     <button id='preview' onclick='popup(mylink2,windowname2)'>PREVIEW</button>\
              //   </div>\
              //   <button id = 'rematch'>REMATCH</button></div>\
              // ");
            }
          })
        });
        $(".homebutton").click(function(){
          $.ajax({      
            success: function(){
              $("#content").html("Welcome to the Home page!");
            }
          })
        });
        $(".aboutbutton").click(function(){
          $.ajax({      
            success: function(){
              $("#content").html("Welcome to the About!");
            }
          })
        });
      });
      $(".contactbutton").click(function(){
        $.ajax({
          success: function(){
            $("#content").html("Welcome to the Contact page!");
          }
        });
      });
      // References used to fix issue when jQuery events were not responding for AJAX-generated HTML: 
      // http://stackoverflow.com/questions/17206805/jquery-does-not-work-on-ajax-generated-html
      // http://stackoverflow.com/questions/9344306/jquery-click-doesnt-work-on-ajax-generated-content
      $("#content").on("click", "#loginButtonOnForm", function(){
         console.log("running!")
        $.ajax({
          url: "cgi-bin/log.py",
          // Data that will be sent as an input to the log.py script.
          data: {
          usernameValue: $("#usernameBox").val(),
          passwordValue: $("#passwordBox").val(),
          // zipcodeValue: 999999 //just to make it work, never used
          },
          type: "GET",
          dataType: "json",
         
          success: function(data){
            // $("#content").html("Logged in"+data.myUsername + "password" + data.myPassword);
             $("#content").html("Welcome "+ data.myUsername+"!"+"\
                <div id='leftCol' style='float: left; width: 30%; background-color:white; height: 400px;'>\
                  <h1>My donations</h1>\
                  <p> this is a test</p>\
                  <button id='update' onclick='popup(mylink, windowname)'>New donation</button>\
                  <div id='donateitems'></div>\
                </div>\
                <div id='rightCol' style='float: right; width: 70%; background-color:gray; height:400px'>\
                <h1>my matches</h1>\
                <p> this is div 2</p>\
                <div id = 'item1' style='float:left; width =30%; background-color:blue; height: 200px;'>\
                  <img src='elephant.jpe' width = '50px'>\
                  <h4>Organization Name</h4>\
                  <p>Here is information about this wonderful organization</p>\
                  <button id='preview' onclick='popup(mylink2,windowname2)'>PREVIEW</button>\
                </div>\
                <button id = 'rematch'>REMATCH</button></div>\
              ");
          }, 
          error: function(){
             $("#content").html("Not Found!");
          }
        })
      });
      $("#content").on("click", "#update", function(){
        $.ajax({
          url: "cgi-bin/gettypes.py",
          type: "GET",
          dataType: "json",
          success: function(data){
            var count = Object.keys(data).length;
            var selectoptiontype = '';
            for (var number = 0; number < count; number++){
              //selectoptiontype += "<option value="+number+">"+data[1]+"</option>";
            }
            $.each(data, function(key, value){
              //console.log("Key: "+key+" Value:"+value);
              selectoptiontype += "<option value="+key+">"+value+"</option>";
            });
            $("#donateitems").html("\
              <div>\
                <span>Type:</span>\
                <select id='selecttype'>\
                  <option value='0'>[Select type]</option>\
                  "+selectoptiontype+"\
                </select>\
              </div>\
              <div>\
                <span>Subtype:</span>\
                <span id='spanselectsubtype'></span>\
              </div>\
              <div>\
                <span>Quantity:</span>\
                <input id='quantityinput' type='text' size='10' />\
              </div>\
              <div><button id='donateitembutton'>Donate item</button></div>\
            ");            
          }
        })     
      });
      $("#content").on("change", "#selecttype", function(){
        $.ajax({
          success: function(){
            //console.log("Congratulations brother."+$("#selecttype").val());
            var selectoptionsubtype = '';
            for (var number = 0; number < 3; number++){
              selectoptionsubtype += "<option value=0"+number+">0"+$("#selecttype").val()+"</option>";
            }
            $("#spanselectsubtype").html("\
              <select id='selectsubtype'>\
                <option value='0'>[Select type]</option>\
                "+selectoptionsubtype+"\
              </select>\
            ");
          }
        })
      });
      $("#content").on("click", "#donateitembutton", function(){
        $.ajax({
          url: "cgi-bin/donate.py",
          type: "POST",
          dataType: "json",
          data: {
            itemidValue: $("#selectsubtype").val(),
            quantityValue: $("#quantityinput").val()
          },
          success: function(data){
            $("#donateitems").html("Thank you for your donation!"+$("#selecttype").val()+" "+$("#selectsubtype").val()+" "+$("#quantityinput").val()+data);
          }
        })
      });

     $("#content").on("click", "#signup", function(){
        $.ajax({
          url: "cgi-bin/crud.py",
          type: "POST",
          dataType: "json",
          data: {
          usernameValue: $("#user_name").val(),
          passwordValue: $("#user_password").val(),
          zipcodeValue: $("#user_zip").val()
        },
        success: function(data){
      console.log("signup")
            $("#content").html("Signed Up");
          }
        })
      });
    
      var mylink = "addItems.html";
      var windowname = "Bob";
      var mylink2 = "preview.html";
      var windowname2 = "Preview";
      function popup(mylink, windowname) { 
        console.log("hey");
        if (! window.focus)return true; 
          var href;
        if (typeof(mylink) == 'string') 
          href=mylink;
        else 
          href=mylink.href; 
          window.open(href, windowname, 'width=400,height=200,scrollbars=yes'); 
          return false; 
      }
    </script>
  </body>
</html>
